(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[838],{23795:function(t,e,n){"use strict";n.d(e,{Z:function(){return _}});var i=n(63366),a=n(87462),r=n(67294),o=n(90512),l=n(94780),u=n(98216),s=n(90948),p=n(71657),y=n(18791),c=n(51705),m=n(15861),d=n(1588),f=n(34867);function getLinkUtilityClass(t){return(0,f.Z)("MuiLink",t)}let T=(0,d.Z)("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]);var g=n(54844),b=n(41796);let w={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},transformDeprecatedColors=t=>w[t]||t;var Link_getTextDecoration=({theme:t,ownerState:e})=>{let n=transformDeprecatedColors(e.color),i=(0,g.DW)(t,`palette.${n}`,!1)||e.color,a=(0,g.DW)(t,`palette.${n}Channel`);return"vars"in t&&a?`rgba(${a} / 0.4)`:(0,b.Fq)(i,.4)},h=n(85893);let x=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],useUtilityClasses=t=>{let{classes:e,component:n,focusVisible:i,underline:a}=t,r={root:["root",`underline${(0,u.Z)(a)}`,"button"===n&&"button",i&&"focusVisible"]};return(0,l.Z)(r,getLinkUtilityClass,e)},v=(0,s.ZP)(m.Z,{name:"MuiLink",slot:"Root",overridesResolver:(t,e)=>{let{ownerState:n}=t;return[e.root,e[`underline${(0,u.Z)(n.underline)}`],"button"===n.component&&e.button]}})(({theme:t,ownerState:e})=>(0,a.Z)({},"none"===e.underline&&{textDecoration:"none"},"hover"===e.underline&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},"always"===e.underline&&(0,a.Z)({textDecoration:"underline"},"inherit"!==e.color&&{textDecorationColor:Link_getTextDecoration({theme:t,ownerState:e})},{"&:hover":{textDecorationColor:"inherit"}}),"button"===e.component&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${T.focusVisible}`]:{outline:"auto"}})),S=r.forwardRef(function(t,e){let n=(0,p.Z)({props:t,name:"MuiLink"}),{className:l,color:u="primary",component:s="a",onBlur:m,onFocus:d,TypographyClasses:f,underline:T="always",variant:g="inherit",sx:b}=n,S=(0,i.Z)(n,x),{isFocusVisibleRef:_,onBlur:M,onFocus:P,ref:V}=(0,y.Z)(),[j,Z]=r.useState(!1),I=(0,c.Z)(e,V),k=(0,a.Z)({},n,{color:u,component:s,focusVisible:j,underline:T,variant:g}),C=useUtilityClasses(k);return(0,h.jsx)(v,(0,a.Z)({color:u,className:(0,o.Z)(C.root,l),classes:f,component:s,onBlur:t=>{M(t),!1===_.current&&Z(!1),m&&m(t)},onFocus:t=>{P(t),!0===_.current&&Z(!0),d&&d(t)},ref:I,ownerState:k,variant:g,sx:[...Object.keys(w).includes(u)?[]:[{color:u}],...Array.isArray(b)?b:[b]]},S))});var _=S},70526:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manager/[ZKPollContractAddress]/registration",function(){return n(74882)}])},74882:function(t,e,n){"use strict";n.r(e);var i=n(85893),a=n(82713),r=n(57200),o=n(2810),l=n(97553),u=n(46041),s=n(87357),p=n(69417),y=n(15861),c=n(23795),m=n(12833),d=n(51233),f=n(50480),T=n(59653),g=n(98456),b=n(5152),w=n.n(b),h=n(11163),x=n(67294),v=n(96916);w()(()=>Promise.all([n.e(279),n.e(229)]).then(n.bind(n,47229)),{loadableGenerated:{webpack:()=>[47229]},ssr:!1});let S=n(52325).tt,_=n(52647).VA,M=[{inputs:[{internalType:"uint256[2]",name:"_mpk",type:"uint256[2]"},{components:[{internalType:"string",name:"title",type:"string"},{internalType:"uint256",name:"numOptions",type:"uint256"},{internalType:"string[]",name:"optionDescriptions",type:"string[]"}],internalType:"struct ZKPoll.PollInfoParams",name:"_params",type:"tuple"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{components:[{internalType:"string",name:"title",type:"string"},{internalType:"uint256",name:"numOptions",type:"uint256"},{internalType:"string[]",name:"optionDescriptions",type:"string[]"}],indexed:!1,internalType:"struct ZKPoll.PollInfoParams",name:"params",type:"tuple"}],name:"ChangePollInfoEvent",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"status",type:"uint256"}],name:"ChangePollStatusEvent",type:"event"},{anonymous:!1,inputs:[{components:[{internalType:"uint256",name:"m",type:"uint256"},{internalType:"uint256",name:"cm",type:"uint256"},{internalType:"uint256",name:"nf",type:"uint256"},{internalType:"uint256",name:"root",type:"uint256"},{internalType:"uint256[2]",name:"proof_a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"proof_b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"proof_c",type:"uint256[2]"}],indexed:!1,internalType:"struct Verifier.TallyParams",name:"params",type:"tuple"}],name:"TallyEvent",type:"event"},{anonymous:!1,inputs:[{components:[{internalType:"uint256",name:"cm",type:"uint256"},{internalType:"uint256",name:"newRoot",type:"uint256"},{internalType:"uint256",name:"oldRoot",type:"uint256"},{internalType:"uint256",name:"newKey",type:"uint256"},{internalType:"uint256",name:"newValue",type:"uint256"},{internalType:"uint256[2]",name:"fnc",type:"uint256[2]"},{internalType:"uint256[2]",name:"proof_a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"proof_b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"proof_c",type:"uint256[2]"}],indexed:!1,internalType:"struct Verifier.TallySMTProcessorParams",name:"params",type:"tuple"}],name:"TallySMTProcessorEvent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"cm",type:"uint256"},{components:[{internalType:"uint256",name:"cm",type:"uint256"},{internalType:"uint256",name:"nf",type:"uint256"},{internalType:"uint256[2]",name:"ct0",type:"uint256[2]"},{internalType:"uint256",name:"ct1",type:"uint256"},{internalType:"uint256[2]",name:"mpk",type:"uint256[2]"},{internalType:"uint256",name:"root",type:"uint256"},{internalType:"uint256[2]",name:"proof_a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"proof_b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"proof_c",type:"uint256[2]"}],indexed:!1,internalType:"struct Verifier.VoteParams",name:"params",type:"tuple"}],name:"VoteEvent",type:"event"},{anonymous:!1,inputs:[{components:[{internalType:"uint256",name:"newRoot",type:"uint256"},{internalType:"uint256",name:"oldRoot",type:"uint256"},{internalType:"uint256",name:"newKey",type:"uint256"},{internalType:"uint256",name:"newValue",type:"uint256"},{internalType:"uint256[2]",name:"fnc",type:"uint256[2]"},{internalType:"uint256[2]",name:"proof_a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"proof_b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"proof_c",type:"uint256[2]"}],indexed:!1,internalType:"struct Verifier.VoterSMTProcessorParams",name:"params",type:"tuple"}],name:"VoterSMTProcessorEvent",type:"event"},{inputs:[],name:"TallySMTProcessorVerifierAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"TallyVerifierAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"VoteVerifierAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"VoterSMTProcessorVerifierAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"string",name:"title",type:"string"},{internalType:"uint256",name:"numOptions",type:"uint256"},{internalType:"string[]",name:"optionDescriptions",type:"string[]"}],internalType:"struct ZKPoll.PollInfoParams",name:"_params",type:"tuple"}],name:"changePollInfo",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_status",type:"uint256"}],name:"changePollStatus",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"iTallySMTProcessorVerifier",outputs:[{internalType:"contract ITallySMTProcessorVerifier",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"iTallyVerifier",outputs:[{internalType:"contract ITallyVerifier",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"iVoteVerifier",outputs:[{internalType:"contract IVoteVerifier",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"iVoterSMTProcessorVerifier",outputs:[{internalType:"contract IVoterSMTProcessorVerifier",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"manager",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"mpk",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"status",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"uint256",name:"m",type:"uint256"},{internalType:"uint256",name:"cm",type:"uint256"},{internalType:"uint256",name:"nf",type:"uint256"},{internalType:"uint256",name:"root",type:"uint256"},{internalType:"uint256[2]",name:"proof_a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"proof_b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"proof_c",type:"uint256[2]"}],internalType:"struct Verifier.TallyParams",name:"_params",type:"tuple"}],name:"tally",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"tallyNullifier",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"uint256",name:"cm",type:"uint256"},{internalType:"uint256",name:"newRoot",type:"uint256"},{internalType:"uint256",name:"oldRoot",type:"uint256"},{internalType:"uint256",name:"newKey",type:"uint256"},{internalType:"uint256",name:"newValue",type:"uint256"},{internalType:"uint256[2]",name:"fnc",type:"uint256[2]"},{internalType:"uint256[2]",name:"proof_a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"proof_b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"proof_c",type:"uint256[2]"}],internalType:"struct Verifier.TallySMTProcessorParams",name:"_params",type:"tuple"}],name:"tallySMTProcessor",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"tallySMTRoot",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"uint256",name:"cm",type:"uint256"},{internalType:"uint256",name:"nf",type:"uint256"},{internalType:"uint256[2]",name:"ct0",type:"uint256[2]"},{internalType:"uint256",name:"ct1",type:"uint256"},{internalType:"uint256[2]",name:"mpk",type:"uint256[2]"},{internalType:"uint256",name:"root",type:"uint256"},{internalType:"uint256[2]",name:"proof_a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"proof_b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"proof_c",type:"uint256[2]"}],internalType:"struct Verifier.VoteParams",name:"_params",type:"tuple"}],name:"vote",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"voterNullifier",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"uint256",name:"newRoot",type:"uint256"},{internalType:"uint256",name:"oldRoot",type:"uint256"},{internalType:"uint256",name:"newKey",type:"uint256"},{internalType:"uint256",name:"newValue",type:"uint256"},{internalType:"uint256[2]",name:"fnc",type:"uint256[2]"},{internalType:"uint256[2]",name:"proof_a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"proof_b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"proof_c",type:"uint256[2]"}],internalType:"struct Verifier.VoterSMTProcessorParams",name:"_params",type:"tuple"}],name:"voterSMTProcessor",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"voterSMTRoot",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}];e.default=function(){let t=(0,h.useRouter)(),[e,n]=(0,x.useState)(""),b=(0,x.useRef)(null),[w,P]=(0,x.useState)(null),[V,j]=(0,x.useState)({}),[Z,I]=(0,x.useState)(""),[k,C]=(0,x.useState)(!1),[B,A]=(0,x.useState)(""),[F,R]=(0,x.useState)(!0),[O,E]=(0,x.useState)(!1),[K,D]=(0,x.useState)(!1);return(0,x.useEffect)(()=>()=>{b.current.clear().catch(t=>{console.log("Failed to clear html5QrcodeScanner. ",t)})},[]),(0,x.useEffect)(()=>{t.isReady&&(n(t.query.ZKPollContractAddress),b.current=new v.wF("QRCode-Scanner",{fps:10,qrbox:{width:400,height:400}},!1),b.current.render(async(t,e)=>{try{let e=JSON.parse(t);P(e),b.current.clear().catch(t=>{console.log("Failed to clear html5QrcodeScanner. ",t)}),R(!0);let n=await fetch("/key/VoterCommitment_verification_key.json"),i=await n.json(),a=await S.verify(i,e.publicSignals,e.proof);j({cm:e.cm,verify:a,contractAddress:e.contractAddress}),R(!1)}catch(t){console.log(t)}},t=>{}))},[t.isReady]),(0,i.jsx)(s.Z,{component:"main",sx:{flexGrow:1,p:3},children:(0,i.jsxs)(d.Z,{spacing:2,direction:"column",children:[(0,i.jsx)(y.Z,{align:"center",variant:"h3",gutterBottom:!0,children:"투표자 등록"}),(0,i.jsx)("div",{id:"QRCode-Scanner",width:"400px"}),w?F?(0,i.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,i.jsx)(g.Z,{})}):(0,i.jsxs)(i.Fragment,{children:[""===B?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(m.Z,{disabled:k||O||K,value:Z,fullWidth:!0,margin:"dense",label:"Wallet PrivateKey",variant:"outlined",onChange:t=>I(t.target.value)}),(0,i.jsx)(f.Z,{control:(0,i.jsx)(T.Z,{disabled:O||K,checked:k,onChange:t=>{t.target.checked&&I(""),C(t.target.checked)}}),label:"MetaMask 사용하기"}),(0,i.jsx)(m.Z,{disabled:!0,value:V.contractAddress,fullWidth:!0,label:"Contract Address",variant:"outlined"}),(0,i.jsx)(m.Z,{disabled:!0,value:V.cm,fullWidth:!0,label:"Voter Commitment",variant:"outlined"}),(0,i.jsx)(m.Z,{disabled:!0,value:V.verify?"OK":"Fail",fullWidth:!0,label:"Commitment Verify",variant:"outlined"})]}):(0,i.jsx)(i.Fragment,{}),""===B?(0,i.jsx)(p.Z,{fullWidth:!0,variant:"contained",disabled:!V.verify||O||e!==V.contractAddress,onClick:async()=>{if(V.verify&&!O&&e===V.contractAddress){E(!0);try{let t=await _(),e=BigInt(-1),n=new u.m({apiKey:"f0WzPUlAwciQu643Kj7fGaFlpzstQOCs",network:u.N.ETH_SEPOLIA}),i=await n.core.getLogs({fromBlock:0,toBlock:"latest",address:V.contractAddress,topics:["0x4171e10293049cf35c26bb7ff1182f5a460122fe600e84f00cd6bcdd6802f322"]});for(let n=0;n<i.length;n++){let a=i[n];a.data,BigInt("0x"+a.data.slice(2,66)).toString(),BigInt("0x"+a.data.slice(66,130)).toString();let r=BigInt("0x"+a.data.slice(130,194)).toString(),o=BigInt("0x"+a.data.slice(194,258)).toString();BigInt("0x"+a.data.slice(258,322)).toString(),BigInt("0x"+a.data.slice(322,386)).toString();let l=t.F.e(r),u=t.F.e(o);await t.insert(l,u),e<BigInt(r)&&(e=BigInt(r))}let s=e+BigInt(1),p=t.F.e(s),y=t.F.e(BigInt(V.cm).toString()),c=await t.insert(p,y),m=c.siblings;for(let e=0;e<m.length;e++)m[e]=t.F.toObject(m[e]);for(;m.length<10;)m.push(0);let d={fnc:[1,0],oldRoot:t.F.toObject(c.oldRoot),siblings:m,oldKey:c.isOld0?0:t.F.toObject(c.oldKey),oldValue:c.isOld0?0:t.F.toObject(c.oldValue),isOld0:c.isOld0?1:0,newKey:t.F.toObject(p),newValue:t.F.toObject(y)},{proof:f,publicSignals:T}=await S.fullProve(d,"/wasm/VoterSMTProcessor.wasm","/key/VoterSMTProcessor_final.zkey"),g="0x"+BigInt(T[0]).toString(16),b="0x"+BigInt(T[1]).toString(16),w="0x"+BigInt(T[2]).toString(16),h="0x"+BigInt(T[3]).toString(16),x="0x"+BigInt(T[4]).toString(16),v="0x"+BigInt(T[5]).toString(16),P=["0x"+BigInt(f.pi_a[0]).toString(16),"0x"+BigInt(f.pi_a[1]).toString(16)],j=[["0x"+BigInt(f.pi_b[0][1]).toString(16),"0x"+BigInt(f.pi_b[0][0]).toString(16)],["0x"+BigInt(f.pi_b[1][1]).toString(16),"0x"+BigInt(f.pi_b[1][0]).toString(16)]],I=["0x"+BigInt(f.pi_c[0]).toString(16),"0x"+BigInt(f.pi_c[1]).toString(16)];if(k){if(void 0!==window.ethereum&&window.ethereum.isMetaMask&&"0xaa36a7"===window.ethereum.chainId){let t=new a.Q(window.ethereum),e=await t.getSigner(),n=new r.CH(V.contractAddress,M,e),i=await n.voterSMTProcessor([g,b,w,h,[x,v],P,j,I]);A(i.hash),E(!1),D(!0),await i.wait(),D(!1)}}else{let t=new o.A("sepolia","MJ26AUMX5QW7BEPHCC5PSZ6H9FRXQ637IM"),e=new l.w(Z,t),n=new r.CH(V.contractAddress,M,e),i=await n.voterSMTProcessor([g,b,w,h,[x,v],P,j,I]);A(i.hash),E(!1),D(!0),await i.wait(),D(!1)}}catch(t){E(!1),console.log(t)}}},children:O?(0,i.jsx)(g.Z,{size:"1rem",color:"inherit"}):V.verify?e!==V.contractAddress?(0,i.jsx)(i.Fragment,{children:"컨트랙트 주소 불일치"}):(0,i.jsx)(i.Fragment,{children:"등록하기"}):(0,i.jsx)(i.Fragment,{children:"유효하지 않은 Commitment"})}):K?(0,i.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,i.jsx)(g.Z,{})}):(0,i.jsx)(c.Z,{target:"_blank",align:"center",href:"https://sepolia.etherscan.io/tx/".concat(B),children:B}),(0,i.jsx)(p.Z,{disabled:O,fullWidth:!0,variant:"outlined",onClick:()=>{O||(P(null),A(""),b.current=new v.wF("QRCode-Scanner",{fps:10,qrbox:{width:400,height:400}},!1),b.current.render(async(t,e)=>{try{let e=JSON.parse(t);P(e),b.current.clear().catch(t=>{console.log("Failed to clear html5QrcodeScanner. ",t)}),R(!0);let n=await fetch("/key/VoterCommitment_verification_key.json"),i=await n.json(),a=await S.verify(i,e.publicSignals,e.proof);j({cm:e.cm,verify:a,contractAddress:e.contractAddress}),R(!1)}catch(t){console.log(t)}},t=>{}))},children:"다시 스캔하기"})]}):(0,i.jsx)(i.Fragment,{})]})})}},46601:function(){},27790:function(){},95979:function(){},52361:function(){},94616:function(){},82825:function(){}},function(t){t.O(0,[714,792,505,808,860,430,240,417,237,94,547,10,169,418,761,958,783,916,774,888,179],function(){return t(t.s=70526)}),_N_E=t.O()}]);